<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/template/merchantPageTemplate.xhtml" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:pe="http://primefaces.org/ui/extensions">


	<ui:define name="metadata">
		<f:metadata>
			<f:viewAction action="#{insertProdottiView.doInit}"></f:viewAction>
		</f:metadata>
	</ui:define>


	<ui:define name="title">
		<h:outputText value="Inserimento Prodotti"></h:outputText>
	</ui:define>

	<ui:define name="Pagina">PRODOTTI</ui:define>
	<ui:define name="PaginaBreadcrumb">Inserimento Prodotti</ui:define>

	<ui:define name="bodyPageContent">
		<h:form prependId="false" id="frmProd" styleClass="form-horizontal">
			<p:growl id="messages" showDetail="true" autoUpdate="true" />

			<div class="row">
				<div class="col-sm-4">
					<h3 class="form-titoli">
						<h:outputText value="PRODOTTI" />
					</h3>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="form-group spacer10">
						<p:outputLabel for="barcode" class="col-sm-1 control-label" value="Barcode" />
						<div class="col-sm-3 ">
							<p:inputText styleClass="form-control" maxlength="30" id="barcode" required="true"
								value="#{insertProdottiView.merchantCode}" />
						</div>
						<div class="col-sm-2 col-sm-offset-6">
							<p:commandButton validateClient="true" styleClass="ui-priority-primary"
								onerror="PF('blockAll').unblock();" oncomplete="PF('blockAll').unblock();"
								onclick="PF('blockAll').block()" actionListener="#{insertProdottiView.addProduct}"
								ajax="false" value="Aggiungi Prodotto">
							</p:commandButton>
						</div>
					</div>

					<div class="form-group">
						<p:outputLabel for="genere" styleClass="col-sm-1 control-label" value="Genere" />
						<div class="col-sm-3">
							<p:autoComplete required="true" minQueryLength="1" dropdown="true" id="genere"
								value="#{insertProdottiView.genere}" completeMethod="#{insertProdottiView.completeGenere}"
								var="gender" itemLabel="#{gender.valore}" itemValue="#{gender}"
								converter="it.othala.GenderConverter" forceSelection="true">
							</p:autoComplete>
							<p:commandButton title="Aggiungi Genere" icon="ui-icon-plus" type="button"
								onclick="PF('dlg2').show();" />
						</div>

						<p:outputLabel for="tipo" styleClass="col-sm-1 control-label" value="Tipo" />
						<div class="col-sm-3">
							<p:autoComplete scrollHeight="#{insertProdottiView.SCROLL_WIDTH_AUTOCOMPLETE}"
								required="true" minQueryLength="1" dropdown="true" id="tipo"
								value="#{insertProdottiView.tipo}" completeMethod="#{insertProdottiView.completeTipo}"
								var="type" itemLabel="#{type.valore}" itemValue="#{type}"
								converter="it.othala.TypeConverter" forceSelection="true">
								<p:ajax event="itemSelect" update=":frm-arts" />
							</p:autoComplete>

						</div>
					</div>

					<div class="form-group">
						<p:outputLabel for="brand" styleClass="col-sm-1 control-label" value="Brand" />
						<div class="col-sm-3">
							<p:autoComplete scrollHeight="#{insertProdottiView.SCROLL_WIDTH_AUTOCOMPLETE}"
								required="true" minQueryLength="1" dropdown="true" id="brand"
								value="#{insertProdottiView.brand}" completeMethod="#{insertProdottiView.completeBrand}"
								var="brand" itemLabel="#{brand.valore}" itemValue="#{brand}"
								converter="it.othala.BrandConverter" forceSelection="true" />
						</div>
					</div>

					<div class="form-group">
						<p:outputLabel for="prezzoPrd" styleClass="col-sm-1 control-label" value="Prezzo" />
						<div class="col-sm-2">

							<pe:inputNumber widgetVar="f6" symbol="&#8364; " id="prezzoPrd" required="true"
								value="#{insertProdottiView.prezzo}" decimalSeparator="," thousandSeparator="."
								decimalPlaces="2" />

						</div>

						<p:outputLabel class="col-sm-1 control-label" for="sconto" styleClass="col-sm-1 control-label"
							value="Sconto" />
						<div class="col-sm-1">
							<p:spinner suffix=" %" required="true" size="4" id="sconto"
								value="#{insertProdottiView.sconto}" min="0" max="100" />
						</div>

						<p:outputLabel class="col-sm-1 control-label" for="totPrezzoPrd"
							styleClass="col-sm-2 control-label" value="Totale (&#8364;)" />
						<div class="col-sm-1">
							<pe:inputNumber widgetVar="totWidget" required="true" symbol="&#8364;" size="10"
								id="totPrezzoPrd" value="#{insertProdottiView.prezzoScontato}" disabled="true"
								decimalSeparator="," thousandSeparator="." decimalPlaces="2" />
						</div>
					</div>

					<div class="form-group">
						<p:outputLabel styleClass="col-sm-1 control-label" for="desc" value="Descrizione" />
						<div class="col-sm-6">

							<p:inputText required="true" styleClass="form-control"
								value="#{insertProdottiView.descrizione}" id="desc"></p:inputText>

						</div>

					</div>




				</div>
			</div>
			<p:dialog header="Nuovo Genere" widgetVar="dlg2" modal="true" height="100">

				<div class="row text-center">
				<div class="col-sm-12 ">


					<p:inputText size="40"></p:inputText>
					<br/><br/>
					
						<p:commandButton value="Inserisci"></p:commandButton>
					

				</div>
				</div>

			</p:dialog>
		</h:form>

		<h:form enctype="multipart/form-data" prependId="false" id="frmImages">




			<div class="row spacer10">

				<label for="immagini" class="control-label col-sm-1">Immagini</label>
				<div class="col-sm-11">


					<p:fileUpload fileUploadListener="#{insertProdottiView.handleFileUpload}" 
						allowTypes="/(\.|\/)(gif|jpe?g|png)$/" onerror="PF('blockAll').unblock();" oncomplete="PF('blockAll').unblock();"
								onstart="PF('blockAll').block()" process="@this" required="true"
						update="frmImages :frm-arts" multiple="true" auto="true" />

				</div>
				<h:panelGroup layout="block" rendered="#{insertProdottiView.imagesFile.size()!=0}">
					<div class="row spacer20 clearfix">

						<ui:repeat id="lstImgs" var="imgPrd" value="#{insertProdottiView.imagesFile}">

							<div class="col-sm-2 spacer10">
								<p:graphicImage style="float:left;"
									styleClass="#{insertProdottiView.fileThumb==imgPrd?'sel-thumbinal':''}"
									library="images/cartThumbinals" width="80" height="83" name="#{imgPrd}" />
								<div>
									<h:commandButton image="/imagesExt/remove.png" title="elimina #{imgPrd}"
										actionListener="#{insertProdottiView.removeImgPrd}">
										<f:attribute name="img" value="#{imgPrd}" />
										<f:ajax execute="@this" render="frmImages thumb"></f:ajax>
									</h:commandButton>
									<br />

									<h:commandButton image="/imagesExt/picture_add.png" title="aggiungi thumbinal #{imgPrd}"
										actionListener="#{insertProdottiView.addThumb}">
										<f:attribute name="img" value="#{imgPrd}" />
										<f:ajax execute="@this" render="frmImages thumb"></f:ajax>
									</h:commandButton>
								</div>

							</div>
						</ui:repeat>


					</div>
				</h:panelGroup>
			</div>



		</h:form>

		<h:form prependId="false" id="frm-arts" styleClass="form-horizontal">

			<!-- ARTICOLI -->
			<h3>ARTICOLI</h3>
			<div class="row">
				<div class="col-sm-12">
					<div class="form-group">
						<p:outputLabel for="taglia" class="col-sm-1" value="Taglia" />
						<div class="col-sm-2">

							<p:autoComplete size="8" scrollHeight="#{insertProdottiView.SCROLL_WIDTH_AUTOCOMPLETE}"
								required="true" minQueryLength="1" dropdown="true" id="taglia"
								value="#{insertProdottiView.size}" completeMethod="#{insertProdottiView.completeTaglia}"
								var="attr" itemLabel="#{attr.valore}" itemValue="#{attr}"
								converter="it.othala.SizeConverter" forceSelection="true" />
						</div>


						<p:outputLabel for="colore" class="col-sm-1 control-label" value="Colore" />
						<div class="col-sm-3">

							<p:autoComplete scrollHeight="#{insertProdottiView.SCROLL_WIDTH_AUTOCOMPLETE}"
								required="true" minQueryLength="1" dropdown="true" id="colore"
								value="#{insertProdottiView.color}" completeMethod="#{insertProdottiView.completeColours}"
								var="attr" itemLabel="#{attr.valore}" itemValue="#{attr}"
								converter="it.othala.ColorConverter" forceSelection="true" />
						</div>
					</div>
					<div class="form-group">
						<p:outputLabel for="qta" class="col-sm-1 control-label" value="Quantita" />
						<div class="col-sm-2">

							<p:spinner required="true" size="3" id="qta" value="#{insertProdottiView.qta}" min="1"
								max="100" />
						</div>



						<p:outputLabel for="negozio" class="col-sm-1 control-label" value="Negozio" />
						<div class="col-sm-3">

							<p:autoComplete scrollHeight="#{insertProdottiView.SCROLL_WIDTH_AUTOCOMPLETE}"
								required="true" minQueryLength="1" size="34" dropdown="true" id="negozio"
								value="#{insertProdottiView.shop}" completeMethod="#{insertProdottiView.completeShops}"
								var="shop" itemLabel="#{shop.txShop}" itemValue="#{shop}"
								converter="it.othala.ShopConverter" forceSelection="true" />


						</div>
						<p:commandButton process=":frmProd frm-arts" update="frm-arts"
							actionListener="#{insertProdottiView.addArticle}" id="addPrds" value="Aggiungi Articolo" />


					</div>
					<div class="form-group">
						<label class="control-label col-sm-1">Thumbinal</label>
						<div class="clearfix col-sm-1">
							<div class="sel-thumbinal container-sel-thumbinal ">
								<h:panelGroup id="thumb">
									<p:graphicImage rendered="#{insertProdottiView.fileThumb!=null}"
										title="#{insertProdottiView.fileThumb}" library="images/cartThumbinals" width="80"
										height="83" name="#{insertProdottiView.fileThumb}" />
								</h:panelGroup>
							</div>
						</div>
					</div>

					<!-- elenco articoli -->
					<div class="form-group">
						<label class="control-label col-sm-3">Elenco Articoli</label>       
						<p:dataTable id="arts" rendered="#{insertProdottiView.articles.size()!=0}" var="art"
							value="#{insertProdottiView.articles}">
      
        <p:column headerText="Thumbinal">
           <p:graphicImage title="#{art.thumbnailsUrl}" library="images/cartThumbinals" width="80"
									height="83" name="#{art.thumbnailsUrl}" />
        </p:column>
        <p:column headerText="Taglia">
            <h:outputText value="#{art.txSize}" />
        </p:column>
        <p:column headerText="Colore">
            <h:outputText value="#{art.txColor}" />
        </p:column>
        <p:column headerText="Quantita">
            <h:outputText value="#{art.qtStock}" />
        </p:column>
							<p:column headerText="Negozio">
            <h:outputText value="#{art.shop.txShop}" />
        </p:column>
        <p:column style="width:4%;text-align: center">
           								<h:commandButton title="rimuovi" value="Rimuovi"
									actionListener="#{insertProdottiView.removeArticle}">
									<f:attribute name="idArt" value="#{art.pgArticle}" />
									<f:ajax execute="@this" render="frm-arts"></f:ajax>
								</h:commandButton>
        </p:column>
    </p:dataTable>


					</div>

				</div>

			</div>



			<script type="text/javascript">
			$(document).ready(function() {
				initPrezzo();
							});
						
			</script>

		</h:form>
	</ui:define>
</ui:composition>
