<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="it.othala.product.queries">


	<select id="listSiteImages" resultType="it.othala.dto.SiteImagesDTO">


		SELECT
		idsiteImages,
		txGroupImages,
		pgGroupImages,
		txLibrary,
		txName,
		urlRedirect
		FROM
		${database.schema}site_images
		where txGroupImages != 'newArrivals'

		union all

		SELECT
		idsiteImages,
		txGroupImages,
		pgGroupImages,
		txLibrary,
		txName,
		urlRedirect
		FROM
		${database.schema}site_images a
		where txGroupImages = 'newArrivals'
		and exists
		(select 1 from
		${database.schema}product d,
		${database.schema}article
		e
		where
		d.idProductState = 1

		and d.idGender = a.pgGroupImages

		and e.idProduct =
		d.idProduct
		and
		e.qtStock
		>
		0);



	</select>





</mapper>